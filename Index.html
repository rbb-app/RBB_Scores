<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>RBB Schiedsgericht Punkte</title>

<!-- Vollbild für iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- App-Icon (optional, erst später hochladen) -->
<link rel="apple-touch-icon" href="icon.png">

<!-- Manifest für PWA -->
<link rel="manifest" href="manifest.json">

<style>
:root { --bg:#fff; --fg:#000; --card:#f2f2f2; }
@media (prefers-color-scheme: dark){
  :root { --bg:#121212; --fg:#fff; --card:#1e1e1e; }
}
body{
  font-family:Arial;
  margin:0;
  padding:10px;
  background:var(--bg);
  color:var(--fg);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
input,select,button{padding:6px;font-size:15px;margin:3px;}
h2,h3{text-align:center;}
.container{display:flex;gap:10px;flex-wrap:wrap;}
.team{flex:1;background:var(--card);border-radius:10px;padding:10px;min-width:140px;}
.players{display:flex;flex-wrap:wrap;gap:6px;}
.player{
  padding:10px;border:3px solid #666;border-radius:10px;
  min-width:60px;text-align:center;cursor:pointer;
}
.player.active{background:rgba(0,255,0,.15);}
.status{text-align:center;font-weight:bold;margin-top:6px;}
.ok{color:#4caf50;} .fail{color:#f44336;}
button{cursor:pointer;}
</style>
</head>

<body>

<h2>Rollstuhlbasketball – Schiedsgericht</h2>

<h3>Spiel-Setup</h3>
Heim: <input id="nameHeim">
Gast: <input id="nameGast"><br>

Periode:
<select id="period">
  <option>1. Viertel</option>
  <option>2. Viertel</option>
  <option>3. Viertel</option>
  <option>4. Viertel</option>
  <option>Verlängerung</option>
</select>

<button onclick="startGame()">Spiel starten</button>
<button onclick="downloadLog()">Download Wechselhistorie</button>

<h3>Spieler anlegen</h3>
Nr: <input id="num" type="number">
Pkt: <input id="pts" type="number" step="0.5" min="-0.5" max="4.5">
Team:
<select id="teamSelect">
  <option value="heim">Heim</option>
  <option value="gast">Gast</option>
</select>
<button onclick="addPlayer()">+</button>

<div class="container">

<div class="team">
<h3 id="heimTitle"></h3>
<div id="heimPlayers" class="players"></div>
<div id="heimStatus" class="status"></div>
</div>

<div class="team">
<h3 id="gastTitle"></h3>
<div id="gastPlayers" class="players"></div>
<div id="gastStatus" class="status"></div>
</div>

</div>

<script>
let players = JSON.parse(localStorage.getItem("players")) || [];
let active = JSON.parse(localStorage.getItem("active")) || { heim:[], gast:[] };
let log = JSON.parse(localStorage.getItem("log")) || [];

const nameHeim = document.getElementById("nameHeim");
const nameGast = document.getElementById("nameGast");

nameHeim.value = localStorage.getItem("nameHeim") || "Heim";
nameGast.value = localStorage.getItem("nameGast") || "Gast";

function save(){
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("active", JSON.stringify(active));
  localStorage.setItem("log", JSON.stringify(log));
  localStorage.setItem("nameHeim", nameHeim.value);
  localStorage.setItem("nameGast", nameGast.value);
}

function startGame(){
  alert("Spiel gestartet: " + new Date().toLocaleString());
}

function addPlayer(){
  if(!num.value || !pts.value) return;
  players.push({
    num: num.value,
    pts: parseFloat(pts.value),
    team: teamSelect.value
  });
  players.sort((a,b)=>a.num-b.num);
  save(); render();
}

function toggle(team, num){
  const list = active[team];
  const i = list.indexOf(num);
  if(i >= 0) list.splice(i,1);
  else if(list.length < 5) list.push(num);

  logChange(team);
  save(); render();
}

function logChange(team){
  const lineup = active[team];
  const sum = lineup
    .map(n => players.find(p=>p.num==n)?.pts || 0)
    .reduce((a,b)=>a+b,0);

  log.push({
    time: new Date().toLocaleTimeString(),
    period: period.value,
    team: team==="heim" ? nameHeim.value : nameGast.value,
    lineup: [...lineup],
    points: sum.toFixed(1)
  });
}

function render(){
  heimTitle.textContent = nameHeim.value;
  gastTitle.textContent = nameGast.value;

  ["heim","gast"].forEach(team=>{
    const div = document.getElementById(team+"Players");
    div.innerHTML = "";

    players.filter(p=>p.team===team).forEach(p=>{
      const el = document.createElement("div");
      el.className = "player";
      el.textContent = `#${p.num}\n${p.pts}`;
      if(active[team].includes(p.num)) el.classList.add("active");
      el.onclick = ()=>toggle(team, p.num);
      div.appendChild(el);
    });

    const sum = active[team]
      .map(n=>players.find(p=>p.num==n)?.pts || 0)
      .reduce((a,b)=>a+b,0);

    const st = document.getElementById(team+"Status");
    st.textContent = "Punkte: " + sum.toFixed(1);
    st.className = "status " + (sum<=14.5 ? "ok" : "fail");
  });
}

function downloadLog(){
  let csv = "Zeit;Periode;Team;Spieler;Punkte\n";
  log.forEach(l=>{
    csv += `${l.time};${l.period};${l.team};${l.lineup.join(",")};${l.points}\n`;
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "wechselhistorie.csv";
  a.click();
}

render();
</script>

</body>
</html>
