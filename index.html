<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<base href="/RBB_Scores/">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<title>RBB Scores</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#fff;
  --fg:#000;
  --card:#f2f2f2;
  --ok:#4caf50;
  --fail:#f44336;
  --fb:#e91e63;
  --jb:#2196f3;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#121212;
    --fg:#fff;
    --card:#1e1e1e;
  }
}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--fg);
}
.hidden{display:none}

#setupView{
  padding-top:calc(env(safe-area-inset-top) + 12px);
  padding:10px;
}
#gameView{
  padding:10px;
}

img.app-icon{
  display:block;
  margin:0 auto 10px;
  width:96px;
  height:96px;
}

h3{text-align:center;margin:10px 0}

input,select,button{
  font-size:14px;
  padding:6px;
}

button{
  cursor:pointer;
  border-radius:6px;
}

.input-row{
  display:flex;
  gap:6px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:6px;
}

input.num{width:50px}
input.pts{width:60px}

.toggle{
  padding:4px 6px;
  border-radius:6px;
  border:1px solid #666;
  font-size:12px;
}
.toggle.active.fb{background:var(--fb);color:#fff}
.toggle.active.jb{background:var(--jb);color:#fff}

.add-player-btn{
  width:44px;
  height:44px;
  border-radius:50%;
  font-size:24px;
  background:var(--ok);
  color:#fff;
  border:none;
}

.container{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.team{
  flex:1;
  min-width:160px;
  background:var(--card);
  border-radius:10px;
  padding:8px;
}

.players{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  justify-content:center;
}

.player{
  position:relative;
  padding:8px;
  border-radius:8px;
  border:2px solid #666;
  min-width:60px;
  text-align:center;
  font-size:13px;
}
.player.active{background:rgba(0,255,0,.25)}

.badge{
  position:absolute;
  left:2px;
  font-size:10px;
  padding:1px 4px;
  border-radius:4px;
  color:#fff;
}
.badge.fb{top:2px;background:var(--fb)}
.badge.jb{bottom:2px;background:var(--jb)}

.remove{
  position:absolute;
  right:4px;
  top:2px;
  color:red;
  font-weight:bold;
  cursor:pointer;
}

.periods{
  margin-top:calc(env(safe-area-inset-top) + 14px);
  margin-bottom:14px;
  display:flex;
  gap:6px;
  justify-content:center;
}
.periods div{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #666;
  font-size:13px;
}
.periods div.active{
  background:var(--ok);
  color:#fff;
}

.team-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:bold;
  margin-bottom:4px;
}

.points.ok{color:var(--ok)}
.points.fail{color:var(--fail)}

.action-bar{
  display:flex;
  gap:6px;
  align-items:center;
  justify-content:center;
  margin-top:6px;
}
.action-bar button{
  padding:4px 8px;
  font-size:12px;
}
.status-text{
  font-size:12px;
  opacity:.8;
}
</style>
</head>

<body>

<!-- SETUP -->
<div id="setupView">
  <img src="icon.png" class="app-icon">

  <h3>Game Setup</h3>

  <div style="text-align:center">
    Home: <input id="homeName"><br>
    Guest: <input id="guestName">
  </div>

  <h3>Add Player</h3>

  <div class="input-row">
    <input id="num" class="num" type="number" placeholder="No">
    <input id="pts" class="pts" type="number" step="0.5" placeholder="Pts">

    <button id="fb" class="toggle fb">FB</button>
    <button id="jb" class="toggle jb">JB</button>
  </div>

  <div class="input-row">
    <select id="teamSel">
      <option value="home">Home</option>
      <option value="guest">Guest</option>
    </select>
    <button class="add-player-btn" onclick="addPlayer()">+</button>
  </div>

  <div class="container">
    <div class="team">
      <h3 id="homeSetupTitle">Home</h3>
      <div id="homeSetup" class="players"></div>
    </div>
    <div class="team">
      <h3 id="guestSetupTitle">Guest</h3>
      <div id="guestSetup" class="players"></div>
    </div>
  </div>

  <div style="text-align:center;margin-top:10px">
    <button onclick="startGame()">Start Game</button>
  </div>
</div>

<!-- GAME -->
<div id="gameView" class="hidden">

<div class="periods" id="periods">
  <div data-p="Q1">Q1</div>
  <div data-p="Q2">Q2</div>
  <div data-p="Q3">Q3</div>
  <div data-p="Q4">Q4</div>
  <div data-p="OT">OT</div>
</div>

<div class="container">
  <div class="team">
    <div class="team-header">
      <span id="homeTitle"></span>
      <span id="homePoints" class="points"></span>
    </div>
    <div id="homePlayers" class="players"></div>
    <div id="homeActions" class="action-bar hidden">
      <button onclick="confirm('home')">Confirm</button>
      <button onclick="undo('home')">Undo</button>
      <span class="status-text">Not confirmed</span>
    </div>
  </div>

  <div class="team">
    <div class="team-header">
      <span id="guestTitle"></span>
      <span id="guestPoints" class="points"></span>
    </div>
    <div id="guestPlayers" class="players"></div>
    <div id="guestActions" class="action-bar hidden">
      <button onclick="confirm('guest')">Confirm</button>
      <button onclick="undo('guest')">Undo</button>
      <span class="status-text">Not confirmed</span>
    </div>
  </div>
</div>

<div style="text-align:center;margin-top:10px">
  <button onclick="endGame()">End Game</button>
</div>
</div>

<script>
let players=[];
let active={home:[],guest:[]};
let tempActive={home:[],guest:[]};
let period="Q1";

const fbBtn=document.getElementById("fb");
const jbBtn=document.getElementById("jb");
fbBtn.onclick=()=>fbBtn.classList.toggle("active");
jbBtn.onclick=()=>jbBtn.classList.toggle("active");

document.querySelectorAll(".periods div").forEach(d=>{
  d.onclick=()=>{
    period=d.dataset.p;
    document.querySelectorAll(".periods div")
      .forEach(x=>x.classList.toggle("active",x===d));
  }
});

function addPlayer(){
  const num=+numEl.value;
  const pts=+ptsEl.value;
  const team=teamSel.value;
  if(!num||!pts) return;
  if(players.filter(p=>p.team===team).length>=12) return alert("Max 12 players");
  if(players.some(p=>p.team===team && p.num===num)) return alert("Number exists");

  let bonus=0;
  if(fbBtn.classList.contains("active") && jbBtn.classList.contains("active")) bonus=2;
  else if(fbBtn.classList.contains("active")) bonus=1.5;
  else if(jbBtn.classList.contains("active")) bonus=1;

  players.push({num,pts:Math.max(0,pts-bonus),fb:fbBtn.classList.contains("active"),jb:jbBtn.classList.contains("active"),team});
  fbBtn.classList.remove("active");
  jbBtn.classList.remove("active");
  numEl.value="";ptsEl.value="";
  render();
}

function startGame(){
  tempActive={home:[...active.home],guest:[...active.guest]};
  period="Q1";
  document.getElementById("setupView").classList.add("hidden");
  document.getElementById("gameView").classList.remove("hidden");
  document.querySelector('[data-p="Q1"]').classList.add("active");
  render();
}

function toggle(team,num){
  const a=active[team];
  a.includes(num)?a.splice(a.indexOf(num),1):a.length<5&&a.push(num);
  document.getElementById(team+"Actions").classList.remove("hidden");
  render();
}

function confirm(team){
  if(calc(team)>14.5) return;
  tempActive[team]=[...active[team]];
  document.getElementById(team+"Actions").classList.add("hidden");
}

function undo(team){
  active[team]=[...tempActive[team]];
  document.getElementById(team+"Actions").classList.add("hidden");
  render();
}

function calc(team){
  return active[team].map(n=>players.find(p=>p.num===n && p.team===team)?.pts||0)
    .reduce((a,b)=>a+b,0);
}

function render(){
  homeTitle.textContent=homeName.value||"Home";
  guestTitle.textContent=guestName.value||"Guest";
  homeSetupTitle.textContent=homeTitle.textContent;
  guestSetupTitle.textContent=guestTitle.textContent;

  ["home","guest"].forEach(t=>{
    const sum=calc(t);
    const el=document.getElementById(t+"Points");
    el.textContent=sum.toFixed(1)+" pts";
    el.className="points "+(sum<=14.5?"ok":"fail");
  });

  renderPlayers("home","homePlayers",false);
  renderPlayers("guest","guestPlayers",false);
  renderPlayers("home","homeSetup",true);
  renderPlayers("guest","guestSetup",true);
}

function renderPlayers(team,target,setup){
  const d=document.getElementById(target);
  d.innerHTML="";
  players.filter(p=>p.team===team).forEach(p=>{
    const e=document.createElement("div");
    e.className="player"+(!setup&&active[team].includes(p.num)?" active":"");
    e.innerHTML=`#${p.num}<br>${p.pts.toFixed(1)}`;
    if(p.fb)e.innerHTML+=`<div class="badge fb">FB</div>`;
    if(p.jb)e.innerHTML+=`<div class="badge jb">JB</div>`;
    if(setup)e.innerHTML+=`<div class="remove" onclick="players=players.filter(x=>x!==players.find(y=>y.num===${p.num}&&y.team==='${team}'));render()">Ã—</div>`;
    else e.onclick=()=>toggle(team,p.num);
    d.appendChild(e);
  });
}

render();
</script>
</body>
</html>